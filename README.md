# Лабораторная работа №5. Методологии SAST и DAST. Триаж уязвимостей
## Практическая часть (SAST-анализ)

### 1) Анализ уязвимого файла с помощью утилиты bandit.

<img width="1277" height="834" alt="image" src="https://github.com/user-attachments/assets/4b884b85-14ad-4b2a-8919-c2f2b504914c" />
<img width="1277" height="612" alt="image" src="https://github.com/user-attachments/assets/2c69f9bd-e3e2-43bd-b18f-4de68982cbee" />

### 2) Описание найденных уязвимостей

#### Уязвимость 1: Flask Debug Mode Enabled (High)

Описание: Приложение запускается с включенным режимом отладки (debug=True), что предоставляет доступ к интерактивному отладчику Werkzeug. В производственной среде это позволяет злоумышленнику выполнять произвольный код на сервере.

Расположение: Строка 256

Угроза: RCE (Remote Code Execution)

#### Уязвимость 2: Unsafe Subprocess with Shell=True (High)

Описание: Использование subprocess.check_output() с параметром shell=True позволяет внедрение команд через переменную host. Формирование команды конкатенацией строк создает классическую уязвимость инъекции команд.

Расположение: Строка 185

Угроза: Command Injection

#### Уязвимость 3: Insecure Deserialization with Pickle (Medium)

Описание: Использование pickle.loads() для десериализации пользовательских данных позволяет выполнение произвольного кода при обработке специально сформированных данных.

Расположение: Строка 165

Угроза: RCE через десериализацию

#### Уязвимость 4: Potentially Dangerous Imports (Low)

Описание: Импорт модулей pickle и subprocess без дополнительных мер безопасности указывает на потенциальные векторы атак, требующие строгого контроля входных данных.

Расположение: Строки 7-8

Угроза: Potential Security Issues

### 3) Анализ уязвимого файла с помощью других утилит.

В нашем случае не получилось просканировать уязвимый файл с помощью альтернативных средств, таких как semgrep (при использовании различных аргументов команды сканирования происходили одни и те же ошибки "permission denied" или "read time out") или SonarQube (при генерации токена оперативная память была критически перегружена, что повлекло за собой прекращение работы виртуальной машины).
<img width="1109" height="858" alt="image" src="https://github.com/user-attachments/assets/61b3537a-f346-422d-a329-bc4f8b8225dc" />

### 4) Сравнительный анализ.

Поскольку на установку и использование утилиты bandit ушло ЗНАЧИТЕЛЬНО меньше времени и ресурсов машины чем на semgrep или SonarQube (которые в конечном итоге даже не привели результаты своей работы), очевидный ввод - bandit является самой лучшей программой для SAST-анализа.

## Практическая часть (DAST-анализ)

### 1) Приложение

<img width="681" height="588" alt="image" src="https://github.com/user-attachments/assets/c77d2c2b-9028-4c5c-8e12-af31aeea991a" /> 
<img width="496" height="230" alt="image" src="https://github.com/user-attachments/assets/3884ab15-3306-4d45-a46e-b1ea35c03b70" />
<img width="556" height="221" alt="image" src="https://github.com/user-attachments/assets/8aae23ee-145a-4bc5-9e58-b0cbc145f2a8" /> 
<img width="524" height="310" alt="image" src="https://github.com/user-attachments/assets/a34573f3-ea2d-4452-a579-8573f3657735" />
<img width="563" height="269" alt="image" src="https://github.com/user-attachments/assets/a7d191fb-5499-4e8b-83e0-a5e8c15c72fa" /> 
<img width="639" height="295" alt="image" src="https://github.com/user-attachments/assets/f49f9865-0321-43e4-8a83-3241961b45c0" />
<img width="903" height="285" alt="image" src="https://github.com/user-attachments/assets/fb34ce3b-a7f0-40d4-9c06-3c85e5190d82" />

### 2) Анализ уязвимого файла с помощью OWASP ZAP
<img width="808" height="573" alt="image" src="https://github.com/user-attachments/assets/daaea0a4-4a4c-4020-b674-195e6a356799" />
<img width="891" height="790" alt="image" src="https://github.com/user-attachments/assets/f55a0b5d-c18c-42d4-8c04-e7833ad71d5b" />
<img width="813" height="465" alt="image" src="https://github.com/user-attachments/assets/4411aafa-f65f-48e9-bd94-56fbc2b2edb6" />
<img width="620" height="281" alt="image" src="https://github.com/user-attachments/assets/a6ad0edd-641b-4c2f-866e-7da69d57b433" />

Скан и Фаззинг

<img width="803" height="537" alt="image" src="https://github.com/user-attachments/assets/2387c0ff-d95b-496a-ad8d-09c793b4684f" />
<img width="894" height="314" alt="image" src="https://github.com/user-attachments/assets/306f5cb9-974e-403c-ac0c-b5dfc8e86ebd" />
<img width="1137" height="196" alt="image" src="https://github.com/user-attachments/assets/14bb6ac8-0e73-41d0-a631-0894eee2d2ee" />

## Практическая часть (триаж уязвимостей)

### Скан с помощью nuclei

<img width="814" height="527" alt="image" src="https://github.com/user-attachments/assets/136c0cd8-184a-438c-8443-e72c1e315710" />
<img width="821" height="543" alt="image" src="https://github.com/user-attachments/assets/cbca4775-ca4d-41f4-ab60-6052b2e59444" />

### Анализ уязвимостей

#### Уязвимость 1: Prometheus Metrics Exposure

Описание уязвимости: эндпоинт /metrics системы мониторинга Prometheus общедоступен без аутентификации. Данный эндпоинт предоставляет детальную информацию о работе приложения, включая метрики производительности, статистику запросов, системные показатели и потенциально конфиденциальные данные о внутренней архитектуре.

Тип: Истинная уязвимость

Критичность: Medium (CVSS ~5.0) - несанкционированный доступ к системным метрикам

Сетевая доступность: интернет - эндпоинт /metrics публично доступен

Ценность актива: метрики производительности, системная информация, данные о работе приложения

Сложность эксплуатации: Low - не требует аутентификации, прямой доступ по URL

Потенциальный ущерб: раскрытие внутренней архитектуры, помощь в планировании дальнейших атак, возможное извлечение конфиденциальных данных через метрики

Последствия эксплуатации:

- Раскрытие информации о внутренней структуре приложения

- Получение данных о производительности и нагрузке системы

- Возможность идентификации узких мест для последующих DDoS-атак

- Сбор информации для построения цепочки эксплуатации

#### Уязвимость 2: Missing Security Headers (8 различных заголовков)

Описание уязвимости: веб-приложение не использует критически важные security-заголовки, что значительно снижает защиту от распространенных веб-атак. Отсутствуют следующие заголовки:

  а) Content-Security-Policy - защита от XSS и инъекций контента

  б) Strict-Transport-Security - принудительное использование HTTPS

  в) X-Content-Type-Options - предотвращение MIME-sniffing

  г) X-Frame-Options - защита от clickjacking

  д) Referrer-Policy - контроль передачи referrer-данных

  е) Permissions-Policy - ограничение доступа к API браузера

  ж) X-Permitted-Cross-Domain-Policies - контроль cross-domain запросов

  з) Clear-Site-Data - управление очисткой данных клиента

Тип: Истинная уязвимость

Критичность: Low-Medium (CVSS ~3.0-4.0) - отсутствие дополнительных механизмов защиты

Сетевая доступность: интернет - влияет на всех пользователей приложения

Ценность актива: веб-приложение, пользовательские сессии, персональные данные

Сложность эксплуатации: Medium - требует комбинации с другими уязвимостями

Потенциальный ущерб: увеличение поверхности атаки, снижение общей безопасности

Ключевые проблемы:

- Content-Security-Policy: отсутствие защиты от XSS-атак

- Strict-Transport-Security: риск downgrade-атак и перехвата трафика

- X-Frame-Options: возможность clickjacking-атак

#### Приоритеты устранения:

Prometheus Metrics Exposure - прямое раскрытие системной информации

Content-Security-Policy - критически важный заголовок для предотвращения XSS

Strict-Transport-Security - защита целостности передаваемых данных

Остальные security headers - улучшение общей безопасности

#### Меры устранения последствий:

Для Prometheus Metrics:

- Краткосрочные: Блокировка доступа к /metrics через веб-сервер, IP-фильтрация

- Долгосрочные: Настройка аутентификации для эндпоинтов мониторинга, вынос метрик в отдельный порт

Для Security Headers:

- Краткосрочные: Добавление заголовков через конфигурацию nginx/apache

- Долгосрочные: Встраивание security headers непосредственно в приложение, регулярный аудит безопасности

Обоснование приоритетов: Prometheus Metrics представляет непосредственную угрозу раскрытия информации, в то время как отсутствие security headers увеличивает общую уязвимость приложения к веб-атакам.

## Сводная таблица

<img width="762" height="277" alt="Снимок экрана 2025-11-28 155616" src="https://github.com/user-attachments/assets/9450e7e7-a534-4156-9e03-58ac165c1070" />

## Ответы на контрольные вопросы

1.	В чем принципиальное отличие SAST от DAST?

- SAST анализирует исходный код без запуска приложения, DAST тестирует работающее приложение через внешние атаки.
  
2.	Какие типы уязвимостей лучше обнаруживает SAST?

- SAST лучше находит SQL-инъекции, XSS, утечки памяти, небезопасные криптографические функции, чувствительные данные.

3.	Какие типы уязвимостей лучше обнаруживает DAST?

- DAST лучше находит конфигурационные ошибки сервера, проблемы аутентификации/сессий, runtime уязвимости, бизнес-логику.

4.	Почему важно использовать оба метода в процессе разработки?

- Оба метода дополняют друг друга: SAST находит кодные ошибки на ранних стадиях, DAST проверяет реальное поведение в среде выполнения.

5.	Какие ограничения имеют каждый из методов?

- Ограничения: SAST - ложные срабатывания, не видит runtime проблемы; DAST - не видит исходный код, требует запущенного приложения.

6.	Что такое AppSec?

- AppSec (Application Security) - процесс обеспечения безопасности приложений на всех этапах жизненного цикла разработки.

7.	Что такое триаж уязвимостей и каковы его основные цели? 

- Триаж уязвимостей - процесс приоритизации уязвимостей на основе риска. Цели: оптимизация ресурсов, фокус на критических угрозах.

8.	Чем простое сканирование на уязвимости отличается от полноценного процесса триажа?

- Сканирование просто находит уязвимости, триаж добавляет анализ риска, бизнес-контекста и приоритезацию исправлений.

9.	Почему автоматический сканер не может полностью заменить человека в процессе триажа? Какие его ограничения компенсирует аналитик?

- Автосканер не понимает контекст, бизнес-логику, дает ложные срабатывания. Аналитик оценивает реальный риск и эксплуатацию.

10.	Почему важно документировать решение об отложении исправления уязвимости с низким приоритетом?

- Документирование уязвимостей с низким приоритом необходимо для аудита, а также для обоснования решений перед руководством.



